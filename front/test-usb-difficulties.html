<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test - √ânigme USB (Difficult√©s)</title>
    <link rel="stylesheet" href="src/styles.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f0f2f5;
      }
      .test-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .difficulty-selector {
        margin-bottom: 20px;
        text-align: center;
      }
      .difficulty-selector button {
        margin: 0 10px;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
      }
      .difficulty-selector button.active {
        background: #3498db;
        color: white;
      }
      .difficulty-selector button:not(.active) {
        background: #ecf0f1;
        color: #2c3e50;
      }
      .puzzle-container {
        border: 2px solid #3498db;
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
      }
      .test-info {
        background: #e8f4f8;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .test-info h3 {
        margin-top: 0;
        color: #2c3e50;
      }
      .expected-answers {
        background: #d4edda;
        padding: 10px;
        border-radius: 5px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>üß™ Test - √ânigme USB (Difficult√©s)</h1>

      <div class="test-info">
        <h3>üìã Instructions de test</h3>
        <p>Testez les 3 niveaux de difficult√© de l'√©nigme USB :</p>
        <ul>
          <li>
            <strong>Facile :</strong> Cl√© USB inconnue (position du chiffre 0 =
            0)
          </li>
          <li>
            <strong>Moyen :</strong> Analyse cl√© USB interne (config3.bak = 3)
          </li>
          <li>
            <strong>Difficile :</strong> Cl√© USB compromise OT
            (script2_update.bat = 2)
          </li>
        </ul>

        <div class="expected-answers">
          <strong>R√©ponses attendues :</strong>
          <ul>
            <li>Facile : <code>0</code> (position du 0 dans INF0MARTION...)</li>
            <li>
              Moyen : <code>3</code> (config3.bak - fichier de configuration
              critique)
            </li>
            <li>
              Difficile : <code>2</code> (script2_update.bat - script ex√©cutable
              critique)
            </li>
          </ul>
        </div>
      </div>

      <div class="difficulty-selector">
        <button onclick="loadDifficulty('easy')" class="active">
          üü¢ Facile
        </button>
        <button onclick="loadDifficulty('medium')">üü† Moyen</button>
        <button onclick="loadDifficulty('hard')">üî¥ Difficile</button>
      </div>

      <div class="puzzle-container">
        <div id="puzzle-content">
          <!-- Le contenu de l'√©nigme sera charg√© ici -->
        </div>
      </div>
    </div>

    <script>
      // Simulation des fonctions globales n√©cessaires
      function completePuzzle(puzzleType, code) {
        console.log(`Puzzle ${puzzleType} compl√©t√© avec le code: ${code}`);
        alert(`‚úÖ Puzzle compl√©t√© ! Code: ${code}`);
      }

      function playSound(soundType) {
        console.log(`Son jou√©: ${soundType}`);
      }

      // Fonction pour charger une difficult√©
      function loadDifficulty(difficulty) {
        // Mettre √† jour les boutons
        document
          .querySelectorAll(".difficulty-selector button")
          .forEach((btn) => {
            btn.classList.remove("active");
          });
        event.target.classList.add("active");

        // Charger l'√©nigme avec la difficult√© sp√©cifi√©e
        const container = document.getElementById("puzzle-content");

        // Cr√©er une version modifi√©e qui utilise la difficult√© s√©lectionn√©e
        const loadUsbPuzzleWithDifficulty = (container) => {
          // Configuration de la difficult√©
          const usbPuzzles = {
            easy: {
              hint: "Le chiffre est √©crit en num√©rique et int√©gr√© dans le texte, il est facile √† rep√©rer.",
              title: "CL√â USB INCONNUE TROUV√âE",
              content: `CL√â USB INCONNUE TROUV√âE

Tu travailles dans une usine et tu trouves une cl√© USB pos√©e sur un bureau.
Elle n'a pas d'√©tiquette et tu ne sais pas √† qui elle appartient.

Sur la cl√© USB, un fichier texte contient la s√©quence :

INF0MARTIONCONFIDENTIELLES

T√¢che : Trouve la position du chiffre dans le mot, celui-ci sera ta cl√©.

‚ö†Ô∏è ATTENTION : Ne jamais brancher une cl√© USB inconnue !
Les supports amovibles sont des vecteurs courants d'intrusion.`,
              answer: "0",
              maxAttempts: 3,
            },
            medium: {
              hint: "Concentre-toi sur le fichier li√© √† la configuration des machines. Le chiffre dans son nom est la cl√©.",
              title: "ANALYSE D'UNE CL√â USB INTERNE",
              content: `ANALYSE D'UNE CL√â USB INTERNE

Un technicien te confie une cl√© USB utilis√©e pour transf√©rer des fichiers 
de mise √† jour des machines. Tu dois v√©rifier son contenu avant de l'utiliser.

Fichiers pr√©sents sur la cl√© :
‚Ä¢ update1.exe
‚Ä¢ config3.bak
‚Ä¢ log5.txt

T√¢che : Quel est le chiffre qui indique le fichier le plus critique 
√† v√©rifier en priorit√© ?

üí° INFO : Un fichier .bak est une sauvegarde de configuration.
Dans l'industrie, ces fichiers contiennent les r√©glages des machines
et peuvent √™tre alt√©r√©s pour changer des param√®tres critiques.`,
              answer: "3",
              maxAttempts: 3,
            },
            hard: {
              hint: "Le chiffre est dans le nom du fichier le plus critique pour la s√©curit√© OT.",
              title: "CL√â USB COMPROMISE DANS UN ENVIRONNEMENT OT",
              content: `CL√â USB COMPROMISE DANS UN ENVIRONNEMENT OT

Une cl√© USB destin√©e √† mettre √† jour le syst√®me de production a √©t√© 
d√©tect√©e comme suspecte par le syst√®me de logs.

Contenu de la cl√© USB :
‚Ä¢ backup6_final.doc
‚Ä¢ script2_update.bat
‚Ä¢ audit4_report.pdf

T√¢che : Trouve le chiffre correspondant au fichier le plus critique 
pour la s√©curit√© OT.

‚ö†Ô∏è CRITIQUE : Un fichier .bat est un script ex√©cutable Windows.
Dans un r√©seau industriel, un script malveillant peut :
‚Ä¢ Alt√©rer les connexions entre serveurs et automates
‚Ä¢ Injecter du code dans des programmes de supervision
‚Ä¢ Ouvrir une porte d'acc√®s √† un hacker`,
              answer: "2",
              maxAttempts: 3,
            },
          };

          const puzzle = usbPuzzles[difficulty];

          container.innerHTML = `
                    <div class="puzzle-hint" style="display: none;">
                        <strong>üí° Indice :</strong> ${puzzle.hint}
                    </div>
                    
                    <div class="usb-container">
                        <div class="usb-header">
                            <h3>${puzzle.title}</h3>
                            <div class="usb-icon">üíæ</div>
                        </div>
                        
                        <div class="usb-content">
                            <div class="usb-files">
                                ${puzzle.content}
                            </div>
                        </div>
                    </div>
                    
                    <div class="code-input-section">
                        <label for="usb-code">Chiffre 1 :</label>
                        <input type="text" id="usb-code" maxlength="1" placeholder="?" />
                        <button id="submit-usb" class="btn btn-primary">Valider</button>
                    </div>
                    
                    <div id="usb-feedback" class="feedback"></div>
                    <div id="usb-attempts" class="attempts-count"></div>
                `;

          // Configuration des √©v√©nements
          const codeInput = container.querySelector("#usb-code");
          const submitBtn = container.querySelector("#submit-usb");
          const feedback = container.querySelector("#usb-feedback");
          const attemptsDisplay = container.querySelector("#usb-attempts");

          let attempts = 0;
          const maxAttempts = puzzle.maxAttempts;

          // Mettre √† jour l'affichage des tentatives
          function updateAttemptsDisplay() {
            attemptsDisplay.textContent = `Tentatives : ${attempts}/${maxAttempts}`;
          }

          // Validation du code
          submitBtn.addEventListener("click", function () {
            const code = codeInput.value.trim();
            attempts++;

            if (code === puzzle.answer) {
              // Code correct
              feedback.innerHTML = `<div class="success">‚úÖ Correct ! Le chiffre est ${puzzle.answer}</div>`;
              codeInput.disabled = true;
              submitBtn.disabled = true;
              submitBtn.textContent = "‚úì R√©solu";

              // Compl√©ter le puzzle
              setTimeout(() => {
                completePuzzle("usb", puzzle.answer);
              }, 1000);

              playSound("success");
            } else {
              // Code incorrect
              if (attempts >= maxAttempts) {
                feedback.innerHTML = `<div class="error">‚ùå √âchec ! Le chiffre √©tait ${puzzle.answer}</div>`;
                codeInput.disabled = true;
                submitBtn.disabled = true;
                submitBtn.textContent = "‚úó √âchou√©";
              } else {
                feedback.innerHTML = `<div class="error">‚ùå Incorrect. ${puzzle.hint}</div>`;
                codeInput.classList.add("shake");
                setTimeout(() => {
                  codeInput.classList.remove("shake");
                }, 500);
              }
              playSound("error");
            }

            updateAttemptsDisplay();
          });

          // Validation en temps r√©el
          codeInput.addEventListener("input", function () {
            this.value = this.value.replace(/\D/g, ""); // Seulement les chiffres
            feedback.innerHTML = "";
          });

          // Validation avec Entr√©e
          codeInput.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              submitBtn.click();
            }
          });

          // Initialiser l'affichage des tentatives
          updateAttemptsDisplay();

          // Focus sur l'input
          codeInput.focus();
        };

        // Charger l'√©nigme
        loadUsbPuzzleWithDifficulty(container);
      }

      // Charger la difficult√© facile par d√©faut
      window.addEventListener("load", () => {
        loadDifficulty("easy");
      });
    </script>
  </body>
</html>
